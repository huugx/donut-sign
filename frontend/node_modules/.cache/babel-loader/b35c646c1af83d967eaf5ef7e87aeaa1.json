{"ast":null,"code":"import _regeneratorRuntime from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{ethers}from\"ethers\";import{ErrorMessage,Modal,Greeting,Disclaimer}from\"../components/containers\";import axios from\"axios\";import{SignMessage,VerifyMessage}from\"../components/wallet/signature\";import{ToggleSwitch}from\"../components/toggleswitch\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Optin=/*#__PURE__*/function(_React$Component){_inherits(Optin,_React$Component);var _super=_createSuper(Optin);function Optin(props){var _this;_classCallCheck(this,Optin);_this=_super.call(this,props);_this.getUserData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var config;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config={params:{address:_this.state.currentAddress}};_context.next=3;return axios.get('/api/user',config).then(function(response){if(!response.data.length){console.log('no user found');_this.setState({isAddressNew:true});}else{var data=response.data;console.log(data);_this.setState({user:data,username:data[0].username,optChain:data[0].chain,isAddressNew:false});}}).catch(function(err){console.log('Internal server error: ',err);});case 3:_this.getInitialState();case 4:case\"end\":return _context.stop();}}},_callee);}));_this.getInitialState=function(){if(_this.state.optChain==='xdai'){_this.setState({toggle:true});}else{_this.setState({toggle:false});}};_this.changeHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var isSigned,isValid;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();_context2.next=3;return _this.handleSign(event);case 3:isSigned=_context2.sent;if(!isSigned){_context2.next=9;break;}_context2.next=7;return _this.handleVerify(event);case 7:isValid=_context2.sent;if(isValid){_this.setState({isSigning:false});_this.setState({toggle:!_this.state.toggle},function(){if(_this.state.toggle===true){_this.setState({value:'xdai'},function(){_this.postData();});}else{_this.setState({value:'ethereum'},function(){_this.postData();});}});}case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.eventListeners=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:window.ethereum.on('accountsChanged',function(accounts){_this.setState({currentAddress:accounts[0]});});window.ethereum.on('chainChanged',function(network){_this.setState({network:parseInt(network)});});case 2:case\"end\":return _context3.stop();}}},_callee3);}));_this.handleSign=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var sig;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:event.preventDefault();_this.setState({isSigning:true});_this.setState({error:null});_context4.next=5;return SignMessage({message:\"Opting in to receive $DONUT \\uD83C\\uDF69 distributions on \".concat(_this.state.value,\", please ensure this address matches the one used to register on /r/Ethtrader! \",\"\\n\\n\",\" \").concat(_this.state.currentAddress)});case 5:sig=_context4.sent;if(sig.error){_context4.next=12;break;}console.log('Signature: ',sig);_this.setState({message:sig.message,signature:sig.signature,error:null});return _context4.abrupt(\"return\",true);case 12:if(4001){_this.setState({error:\"User denied message signature.\",isSigning:false});}else{_this.setState({error:sig.error,isSigning:false});}return _context4.abrupt(\"return\",false);case 14:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2){return _ref4.apply(this,arguments);};}();_this.handleVerify=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var isValid;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return VerifyMessage({message:_this.state.message,address:_this.state.currentAddress,signature:_this.state.signature});case 2:isValid=_context5.sent;if(isValid){_context5.next=5;break;}return _context5.abrupt(\"return\",false);case 5:return _context5.abrupt(\"return\",true);case 6:case\"end\":return _context5.stop();}}},_callee5);}));_this.postData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var payload;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload={address:_this.state.currentAddress,chain:_this.state.value};axios({url:'/api/save',method:'POST',data:payload}).then(function(){console.log(\"Data sent to server! Opted-in to \".concat(payload.chain));_this.setState({successSign:true,isSigning:false});_this.getUserData();}).catch(function(){console.log('Internal server error!');});case 2:case\"end\":return _context6.stop();}}},_callee6);}));_this.state={isMetamaskConnected:false,isAddressNew:true,isSigning:false,successSign:false,active:false,provider:\"\",signer:\"\",message:\"\",currentAddress:\"\",prevAddress:\"\",network:0,signature:\"\",error:\"\",value:\"ethereum\",user:[],username:\"\",optChain:null,toggle:false};return _this;}_createClass(Optin,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var provider,signer,network,currentAddress;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return window.ethereum.request({method:'eth_requestAccounts'});case 2:if(!(typeof window.ethereum!=='undefined')){_context7.next=16;break;}provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context7.next=6;return provider.getSigner();case 6:signer=_context7.sent;_context7.next=9;return provider.getNetwork();case 9:network=_context7.sent;_context7.next=12;return signer.getAddress();case 12:currentAddress=_context7.sent;this.setState({provider:provider,signer:signer,network:network.chainId,currentAddress:currentAddress});this.eventListeners();this.getUserData();case 16:case\"end\":return _context7.stop();}}},_callee7,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Modal,{title:\"Setting Distribution Chain\",button:\"\",onClose:function onClose(){return _this2.setState({isSigning:false});},show:this.state.isSigning,children:/*#__PURE__*/_jsx(\"p\",{children:\"Prove ownership of address by accepting the signature request in your wallet.\"})}),/*#__PURE__*/_jsx(Modal,{title:\"Success\",button:\"OK\",onClose:function onClose(){return _this2.setState({successSign:false});},show:this.state.successSign,children:/*#__PURE__*/_jsxs(\"p\",{children:[\"The distribution chain has been changed to \",this.state.value,\" \"]})})]}),/*#__PURE__*/_jsx(Greeting,{user:this.state.username}),/*#__PURE__*/_jsx(ToggleSwitch,{checked:this.state.toggle,onChange:this.changeHandler}),/*#__PURE__*/_jsx(ErrorMessage,{message:this.state.error}),/*#__PURE__*/_jsx(Disclaimer,{})]});}}]);return Optin;}(React.Component);export default Optin;","map":{"version":3,"sources":["/Users/hugo/Documents/Code/Scripts/donut-sign/frontend/src/pages/optin.js"],"names":["React","ethers","ErrorMessage","Modal","Greeting","Disclaimer","axios","SignMessage","VerifyMessage","ToggleSwitch","Optin","props","getUserData","config","params","address","state","currentAddress","get","then","response","data","length","console","log","setState","isAddressNew","user","username","optChain","chain","catch","err","getInitialState","toggle","changeHandler","event","preventDefault","handleSign","isSigned","handleVerify","isValid","isSigning","value","postData","eventListeners","window","ethereum","on","accounts","network","parseInt","error","message","sig","signature","payload","url","method","successSign","isMetamaskConnected","active","provider","signer","prevAddress","request","providers","Web3Provider","getSigner","getNetwork","getAddress","chainId","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { ethers } from \"ethers\";\nimport { ErrorMessage, Modal, Greeting, Disclaimer } from \"../components/containers\";\nimport axios from \"axios\";\nimport { SignMessage, VerifyMessage } from \"../components/wallet/signature\";\nimport { ToggleSwitch } from \"../components/toggleswitch\";\n\n\nclass Optin extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            isMetamaskConnected: false,\n            isAddressNew: true,\n            isSigning: false,\n            successSign: false,\n            \n            active: false,\n            provider: \"\",\n            signer: \"\",\n            message: \"\",\n            currentAddress: \"\",\n            prevAddress: \"\",\n            network: 0,\n            signature: \"\",\n            error: \"\",\n            value: \"ethereum\",\n            user: [],\n            username: \"\",\n            optChain: null,\n            toggle: false,\n        };\n    }\n\n    async componentDidMount() {\n        await window.ethereum.request({ method: 'eth_requestAccounts' });\n        if (typeof window.ethereum !== 'undefined') {       \n          let provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n          let signer = await provider.getSigner();\n          let network = await provider.getNetwork();\n          let currentAddress = await signer.getAddress();\n  \n          this.setState({\n              provider: provider,\n              signer: signer,\n              network: network.chainId,\n              currentAddress: currentAddress\n          });\n\n          this.eventListeners();\n          this.getUserData();\n        }\n    }\n\n    getUserData = async () => {\n        const config = { params: { address: this.state.currentAddress } };\n\n        await axios.get('/api/user', config)\n        .then((response) => {\n            if (!response.data.length) {\n                console.log('no user found');\n                this.setState({\n                    isAddressNew: true\n                })\n            } else {\n                const data = response.data;\n                console.log(data)\n                this.setState({ \n                    user: data,\n                    username: data[0].username,\n                    optChain: data[0].chain,\n                    isAddressNew: false\n                });\n            }\n        }) .catch((err) => {\n            console.log('Internal server error: ', err); \n        });\n        this.getInitialState();\n    }\n\n    getInitialState = () => {\n        if (this.state.optChain === 'xdai') {\n            this.setState({ toggle: true });\n        } else { \n            this.setState({ toggle: false });\n        }\n    }\n\n    changeHandler = async (event) => {\n        event.preventDefault();\n        const isSigned = await this.handleSign(event);\n        if (isSigned) {\n            const isValid = await this.handleVerify(event);\n            if (isValid) {\n                this.setState({ isSigning: false });\n                this.setState({ toggle: !this.state.toggle }, () => {\n                    if (this.state.toggle === true) { \n                        this.setState({ value:'xdai' }, () => { this.postData() });\n                    } else { \n                        this.setState({ value: 'ethereum' }, () => { this.postData() });\n                    }\n                });\n        }}        \n    }\n\n    // Event Listeners\n    eventListeners = async () => {\n        window.ethereum.on('accountsChanged', (accounts) => {\n            this.setState({ \n                currentAddress: accounts[0] \n            });\n        });\n      \n        window.ethereum.on('chainChanged', (network) => {\n            this.setState({\n                network: parseInt(network)\n            });\n        });\n    }\n\n\n    // Sign and Verify\n    handleSign = async (event) => {\n        event.preventDefault();\n        this.setState({ isSigning: true })\n        this.setState({ error: null });\n\n        const sig = await SignMessage({\n            message: `Opting in to receive $DONUT ðŸ© distributions on ${this.state.value}, please ensure this address matches the one used to register on /r/Ethtrader! ${\"\\n\\n\"} ${this.state.currentAddress}`\n        });\n\n        if (!sig.error) {\n            console.log('Signature: ', sig);\n            this.setState({\n                message: sig.message,\n                signature: sig.signature,\n                error: null\n            })\n            return true;\n        } else {\n            if (4001) {\n                this.setState({\n                    error: \"User denied message signature.\",\n                    isSigning: false\n                });\n            } else {\n                this.setState({\n                    error: sig.error,\n                    isSigning: false\n                });\n            }\n            return false;\n        }\n    }\n\n    handleVerify = async () => {\n        const isValid = await VerifyMessage({\n            message: this.state.message,\n            address: this.state.currentAddress,\n            signature: this.state.signature\n        })\n        \n        if (!isValid) return false;\n        \n        return true;\n    }\n\n    postData = async () => {\n        const payload = {\n            address: this.state.currentAddress,\n            chain: this.state.value\n        };\n\n        axios({\n            url: '/api/save',\n            method: 'POST',\n            data: payload\n        })\n        .then(() => {\n            console.log(`Data sent to server! Opted-in to ${payload.chain}`);\n            this.setState({ \n                successSign: true,\n                isSigning: false,\n            });\n            this.getUserData();\n        })\n        .catch(() => {\n            console.log('Internal server error!')\n        });\n    }\n\n    render() {\n\n        return (\n            <div className=\"content\">\n                <div>\n                    <Modal title=\"Setting Distribution Chain\" button=\"\" onClose={() => this.setState({ isSigning: false })} show={this.state.isSigning}>\n                        <p>Prove ownership of address by accepting the signature request in your wallet.</p>\n                    </Modal>\n                    <Modal title=\"Success\" button=\"OK\" onClose={() => this.setState({ successSign: false })} show={this.state.successSign}>\n                        <p>The distribution chain has been changed to {this.state.value} </p>\n                    </Modal>\n                </div>\n\n                <Greeting user={this.state.username} />\n\n                <ToggleSwitch checked={this.state.toggle} onChange={this.changeHandler} />\n                \n                <ErrorMessage message={this.state.error} />\n\n                <Disclaimer />\n            </div>\n        );\n    }\n}\n\nexport default Optin;"]},"metadata":{},"sourceType":"module"}